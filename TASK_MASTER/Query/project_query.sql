-- SELECT (조건)
-- 프로젝트 조회 (사용자ID)
SELECT 
    PI.PROJECT_SEQ, 
    PI.PROJECT_NAME, 
    PI.PROJECT_DESC, 
    PI.START_DATE, 
    PI.END_DATE,
    PC.PROJECT_USER_CNT,
    PM.FAVORITES_YN
FROM TB_PROJECT_MEMBER PM
LEFT JOIN TB_PROJECT_INFO PI ON PM.PROJECT_SEQ = PI.PROJECT_SEQ
LEFT JOIN (
        SELECT 
            PROJECT_SEQ, 
            COUNT(USER_ID) AS PROJECT_USER_CNT 
        FROM TB_PROJECT_MEMBER 
        GROUP BY PROJECT_SEQ
    ) PC ON PM.PROJECT_SEQ = PC.PROJECT_SEQ
WHERE PM.USER_ID = 'user1';

-- 사용자 조회 (회사코드)
SELECT 
    USER_ID,
    USER_NAME,
    COMPANY_CD,
    JOIN_DATE
FROM TB_USER_INFO 
WHERE COMPANY_CD = 'COMP001';

-- 프로젝트 참여자 조회 (프로젝트SEQ)
SELECT 
    PROJECT_SEQ,
    USER_ID,
    REG_YN,
    MASTER_YN,
    FAVORITES_YN,
    REG_DATE
FROM TB_PROJECT_MEMBER 
WHERE PROJECT_SEQ = 1;

-- 프로젝트 업무 조회 (프로젝트SEQ)
SELECT
    TASK_SEQ,
    PROJECT_SEQ,
    TASK_NAME,
    TASK_DESC,
    START_DATE,
    END_DATE,
    TASK_STATUS,
    FN_GET_COMMON_CD_NAME('TASK_STATUS', TASK_STATUS) AS TASK_STATUS_NAME,
    TASK_PROGRESS,
    REG_DATE,
    REG_ID,
    MOD_DATE,
    MOD_ID
FROM TB_TASK_INFO
WHERE PROJECT_SEQ = 1;

-- 프로젝트 업무 조회 (프로젝트SEQ, 사용자ID)
SELECT
    TI.TASK_SEQ,
    TI.PROJECT_SEQ,
    TI.TASK_NAME,
    TI.TASK_DESC,
    TI.START_DATE,
    TI.END_DATE,
    TI.TASK_STATUS,
    TI.TASK_PROGRESS,
    TI.REG_DATE,
    TI.REG_ID,
    TI.MOD_DATE,
    TI.MOD_ID
FROM TB_TASK_INFO TI
JOIN TB_TASK_MEMBER TM ON TI.TASK_SEQ = TM.TASK_SEQ
WHERE 
    TI.PROJECT_SEQ = 1
    AND TM.USER_ID = 'user1';

-- 댓글 조회 (업무SEQ)
SELECT
    REPLY_SEQ,
    USER_ID,
    REPLY,
    REG_DATE
FROM TB_TASK_REPLY 
WHERE TASK_SEQ = 1;

---------------------------------------------------
-- INSERT
-- 회사정보 INSERT
INSERT INTO TB_COMPANY_INFO (COMPANY_CD, COMPANY_NAME)
VALUES ('COMP001', 'CS 건설');
INSERT INTO TB_COMPANY_INFO (COMPANY_CD, COMPANY_NAME)
VALUES ('COMP002', '오펙 건설');
INSERT INTO TB_COMPANY_INFO (COMPANY_CD, COMPANY_NAME)
VALUES ('COMP003', '전산 디자인.CO');

-- 유저정보 INSERT
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('user1', '유저1', 'user1', 'COMP001', 'aabbccdd11', 'Y', 'Y', SYSDATE);
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('user2', '유저2', 'user2', 'COMP001', 'aabbccdd22', 'Y', 'N', SYSDATE);
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('user3', '유저3', 'user3', 'COMP001', 'aabbccdd33', 'Y', 'N', SYSDATE);
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('aaa1', 'aaa1', 'aaa1', 'COMP001', 'aabbccdd44', 'Y', 'N', SYSDATE);
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('aaa2', 'aaa2', 'aaa2', 'COMP002', 'aabbccdd55', 'Y', 'Y', SYSDATE);
INSERT INTO TB_USER_INFO (USER_ID, USER_NAME, PASSWORD, COMPANY_CD, AUTH_KEY, AUTH_YN, COMP_ADMIN_YN, JOIN_DATE)
VALUES ('aaa3', 'aaa3', 'aaa3', 'COMP002', 'aabbccdd66', 'Y', 'N', SYSDATE);

-- 프로젝트 정보 INSERT
INSERT INTO TB_PROJECT_INFO (PROJECT_SEQ, PROJECT_NAME, PROJECT_DESC, START_DATE, END_DATE, COMPANY_CD, REG_DATE, REG_ID)
VALUES (PROJECT_SEQ.NEXTVAL, 'Project A', 'Project A 테스트', TO_DATE('2024-06-01', 'YYYY-MM-DD'), TO_DATE('2024-12-31', 'YYYY-MM-DD'), 'COMP001', SYSDATE, 'user1');
INSERT INTO TB_PROJECT_INFO (PROJECT_SEQ, PROJECT_NAME, PROJECT_DESC, START_DATE, END_DATE, COMPANY_CD, REG_DATE, REG_ID)
VALUES (PROJECT_SEQ.NEXTVAL, 'Project B', 'Project B 테스트', TO_DATE('2024-06-01', 'YYYY-MM-DD'), TO_DATE('2025-06-01', 'YYYY-MM-DD'), 'COMP001', SYSDATE, 'user1');
INSERT INTO TB_PROJECT_INFO (PROJECT_SEQ, PROJECT_NAME, PROJECT_DESC, START_DATE, END_DATE, COMPANY_CD, REG_DATE, REG_ID)
VALUES (PROJECT_SEQ.NEXTVAL, 'Project C', 'Project C 테스트', TO_DATE('2024-07-01', 'YYYY-MM-DD'), TO_DATE('2026-02-01', 'YYYY-MM-DD'), 'COMP002', SYSDATE, 'aaa2');

-- 프로젝트 멤버 INSERT
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (1, 'user1', 'Y', 'Y', 'Y', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (1, 'user2', 'N', 'N', 'N', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (1, 'user3', 'N', 'N', 'N', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (2, 'user1', 'Y', 'N', 'Y', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (2, 'aaa1', 'N', 'N', 'N', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (2, 'user3', 'N', 'Y', 'N', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (3, 'aaa2', 'Y', 'N', 'Y', SYSDATE);
INSERT INTO TB_PROJECT_MEMBER (PROJECT_SEQ, USER_ID, REG_YN, MASTER_YN, FAVORITES_YN, REG_DATE)
VALUES (3, 'aaa3', 'N', 'N', 'N', SYSDATE);

-- 업무 정보 INSERT
INSERT INTO TB_TASK_INFO (TASK_SEQ, PROJECT_SEQ, TASK_NAME, TASK_DESC, START_DATE, END_DATE, TASK_STATUS, TASK_PROGRESS, REG_DATE, REG_ID)
VALUES (TASK_SEQ.NEXTVAL, 1, 'Task 1', '업무 1 입니다.', TO_DATE('2024-06-01', 'YYYY-MM-DD'), TO_DATE('2024-08-01', 'YYYY-MM-DD'), '0', 0, SYSDATE, 'user1');
INSERT INTO TB_TASK_INFO (TASK_SEQ, PROJECT_SEQ, TASK_NAME, TASK_DESC, START_DATE, END_DATE, TASK_STATUS, TASK_PROGRESS, REG_DATE, REG_ID)
VALUES (TASK_SEQ.NEXTVAL, 1, 'Task 2', '업무 2 입니다.', TO_DATE('2024-06-01', 'YYYY-MM-DD'), TO_DATE('2024-09-01', 'YYYY-MM-DD'), '1', 10, SYSDATE, 'user1');
INSERT INTO TB_TASK_INFO (TASK_SEQ, PROJECT_SEQ, TASK_NAME, TASK_DESC, START_DATE, END_DATE, TASK_STATUS, TASK_PROGRESS, REG_DATE, REG_ID)
VALUES (TASK_SEQ.NEXTVAL, 1, 'Task 3', '업무 3 입니다.', TO_DATE('2024-06-01', 'YYYY-MM-DD'), TO_DATE('2024-10-01', 'YYYY-MM-DD'), '2', 100, SYSDATE, 'user1');
INSERT INTO TB_TASK_INFO (TASK_SEQ, PROJECT_SEQ, TASK_NAME, TASK_DESC, START_DATE, END_DATE, TASK_STATUS, TASK_PROGRESS, REG_DATE, REG_ID)
VALUES (TASK_SEQ.NEXTVAL, 1, 'user1 개인업무', 'user1 개인업무 입니다.', TO_DATE('2024-06-15', 'YYYY-MM-DD'), TO_DATE('2024-08-01', 'YYYY-MM-DD'), '3', 40, SYSDATE, 'user1');

-- 업무 멤버 INSERT
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (1, 'user1', 'Y', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (1, 'user2', 'N', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (2, 'user2', 'Y', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (2, 'user3', 'N', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (3, 'user1', 'Y', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (3, 'user2', 'Y', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (3, 'user3', 'N', SYSDATE);
INSERT INTO TB_TASK_MEMBER (TASK_SEQ, USER_ID, MASTER_YN, REG_DATE)
VALUES (4, 'user1', 'Y', SYSDATE);

-- 업무 댓글 INSERT
INSERT INTO TB_TASK_REPLY (REPLY_SEQ, USER_ID, TASK_SEQ, REPLY, REG_DATE)
VALUES (REPLY_SEQ.NEXTVAL, 'user1', 1, '업무 승인!!', SYSDATE);
INSERT INTO TB_TASK_REPLY (REPLY_SEQ, USER_ID, TASK_SEQ, REPLY, REG_DATE)
VALUES (REPLY_SEQ.NEXTVAL, 'user2', 2, '업무 진행중!!', SYSDATE);
INSERT INTO TB_TASK_REPLY (REPLY_SEQ, USER_ID, TASK_SEQ, REPLY, REG_DATE)
VALUES (REPLY_SEQ.NEXTVAL, 'user3', 3, '업무 끝!!', SYSDATE);
INSERT INTO TB_TASK_REPLY (REPLY_SEQ, USER_ID, TASK_SEQ, REPLY, REG_DATE)
VALUES (REPLY_SEQ.NEXTVAL, 'user1', 3, '업무 확인완료!!', SYSDATE);
INSERT INTO TB_TASK_REPLY (REPLY_SEQ, USER_ID, TASK_SEQ, REPLY, REG_DATE)
VALUES (REPLY_SEQ.NEXTVAL, 'user1', 4, '업무 잠시보류!!', SYSDATE);

-- 공통코드 INSERT
INSERT INTO TB_COMMON_CODE (COMMON_CD_SEQ, COMMON_CD, COMMON_CD_VAL, COMMON_CD_NAME)
VALUES (COMMON_CD_SEQ.NEXTVAL, 'TASK_STATUS', '0', '요청');
INSERT INTO TB_COMMON_CODE (COMMON_CD_SEQ, COMMON_CD, COMMON_CD_VAL, COMMON_CD_NAME)
VALUES (COMMON_CD_SEQ.NEXTVAL, 'TASK_STATUS', '1', '진행');
INSERT INTO TB_COMMON_CODE (COMMON_CD_SEQ, COMMON_CD, COMMON_CD_VAL, COMMON_CD_NAME)
VALUES (COMMON_CD_SEQ.NEXTVAL, 'TASK_STATUS', '2', '완료');
INSERT INTO TB_COMMON_CODE (COMMON_CD_SEQ, COMMON_CD, COMMON_CD_VAL, COMMON_CD_NAME)
VALUES (COMMON_CD_SEQ.NEXTVAL, 'TASK_STATUS', '3', '보류');

---------------------------------------------------
-- UPDATE
-- 프로젝트 정보 UPDATE
UPDATE TB_PROJECT_INFO
SET PROJECT_NAME = 'Project A', 
    PROJECT_DESC = 'Project A 테스트 수정함',
    MOD_DATE = SYSDATE, 
    MOD_ID = 'user1'
WHERE PROJECT_SEQ = 1;

-- 프로젝트 관리자 권한 부여 UPDATE
UPDATE TB_PROJECT_MEMBER
SET MASTER_YN = 'Y'
WHERE 
    PROJECT_SEQ = 1 
    AND USER_ID = 'user2';

-- 프로젝트 즐겨찾기 UPDATE
UPDATE TB_PROJECT_MEMBER
SET FAVORITES_YN = 'Y'
WHERE 
    PROJECT_SEQ = 1 
    AND USER_ID = 'user2';

-- 업무 정보 UPDATE
UPDATE TB_TASK_INFO
SET TASK_STATUS = '3', 
    TASK_PROGRESS = 50,
    MOD_DATE = SYSDATE, 
    MOD_ID = 'user1'
WHERE TASK_SEQ = 4;

-- 댓글 UPDATE
UPDATE TB_TASK_REPLY
SET REPLY = '업무 잠시보류!! / 업무진행률 수정!!', 
    TASK_PROGRESS = 50,
    MOD_DATE = SYSDATE
WHERE 
    REPLY_SEQ = 5 
    AND USER_ID = 'user1';

---------------------------------------------------
-- DROP
DROP TABLE TB_PROJECT_INFO;
DROP TABLE TB_USER_INFO;
DROP TABLE TB_COMPANY_INFO;
DROP TABLE TB_PROJECT_MEMBER;
DROP TABLE TB_TASK_INFO;
DROP TABLE TB_TASK_MEMBER;
DROP TABLE TB_TASK_REPLY;
DROP TABLE TB_COMMON_CODE;

DROP SEQUENCE PROJECT_SEQ;
DROP SEQUENCE TASK_SEQ;
DROP SEQUENCE REPLY_SEQ;
DROP SEQUENCE COMMON_CD_SEQ;

---------------------------------------------------
-- DELETE
DELETE FROM TB_PROJECT_INFO WHERE 1 = 1;
DELETE FROM TB_USER_INFO WHERE 1 = 1;
DELETE FROM TB_COMPANY_INFO WHERE 1 = 1;
DELETE FROM TB_PROJECT_MEMBER WHERE 1 = 1;
DELETE FROM TB_TASK_INFO WHERE 1 = 1;
DELETE FROM TB_TASK_MEMBER WHERE 1 = 1;
DELETE FROM TB_TASK_REPLY WHERE 1 = 1;
DELETE FROM TB_COMMON_CODE WHERE 1 = 1;